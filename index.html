<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>212訂餐網</title>
    <style>
        /* 基礎重置與字體 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            max-width: 500px; /* 手機寬度限制 */
            margin: 0 auto;
            padding-bottom: 60px; /* 為底部導航留空間 */
            height: 100vh;
            overflow-x: hidden;
        }

        /* 頁面容器 */
        .page {
            display: none; /* 預設全部隱藏 */
            padding: 15px;
            min-height: calc(100vh - 60px); /* 視窗高度減去導航列高度 */
        }
        .page.active {
            display: block; /* 只有活動頁面顯示 */
        }

        /* 主頁樣式 */
        #homePage h1 {
            text-align: center;
            color: #2c3e50;
            margin-top: 20px;
            margin-bottom: 30px;
            font-size: 2.2rem;
        }
        #homePage .subtitle {
            text-align: center;
            font-size: 1.4rem;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        /* 點餐頁樣式 */
        #orderPage .iframe-container {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background-color: #fff;
        }
        #orderPage iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #orderPage .info-text {
            text-align: center;
            margin: 15px;
            color: #666;
            font-style: italic;
        }

        /* 日曆頁樣式 */
        #calendarPage .calendar-header {
            text-align: center;
            margin: 20px 0;
            font-size: 1.6rem;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #calendarPage .calendar-nav {
            background: none;
            border: 1px solid #3498db;
            color: #3498db;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        #calendarPage .calendar-weekdays,
        #calendarPage .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        #calendarPage .weekday,
        #calendarPage .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
        }
        #calendarPage .weekday {
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        #calendarPage .day {
            background-color: #fff;
            border: 1px solid #eee;
            cursor: pointer;
            flex-direction: column;
            padding: 5px;
            font-size: 0.9rem;
        }
        #calendarPage .day.today {
            background-color: #3498db;
            color: white;
        }
        #calendarPage .day.past {
            color: #bbb;
            background-color: #f9f9f9;
        }
        #calendarPage .day.form-day {
            background-color: #e8f6f3; /* 淺綠底色表示有表單 */
        }
        #calendarPage .form-name {
            font-size: 0.65rem;
            color: #16a085;
            margin-top: 2px;
            word-break: break-all;
            text-align: center;
        }
        #calendarPage .red-x {
            color: #e74c3c;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* 指南頁樣式 */
        #guidePage .guide-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            min-height: 300px;
            border: 1px solid #ddd;
            white-space: pre-line; /* 保留換行 */
        }
        #guidePage .guide-placeholder {
            color: #95a5a6;
            font-style: italic;
            text-align: center;
            margin-top: 50px;
        }

        /* 固定底部導航 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
            background-color: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
        }
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: #7f8c8d;
            font-size: 0.8rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.2s;
            flex: 1;
            max-width: 80px;
        }
        .nav-btn.active {
            color: #3498db;
            background-color: #ebf5fb;
        }
        .nav-btn i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        /* 響應式調整 */
        @media (max-height: 700px) {
            #orderPage .iframe-container {
                height: 400px;
            }
        }
    </style>
    <!-- 使用Font Awesome圖標 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 主頁 -->
    <div id="homePage" class="page active">
        <h1>212訂餐網</h1>
        <div class="subtitle">今日餐廳</div>
        <!-- 今日餐廳內容將動態填入 -->
        <div id="todayRestaurant" style="text-align: center; margin-top: 30px; font-size: 1.2rem; color: #e74c3c;">
            （待動態載入）
        </div>
    </div>

    <!-- 點餐頁 -->
    <div id="orderPage" class="page">
        <div class="info-text" id="orderInfo">
            正在載入今日訂餐表單...
        </div>
        <div class="iframe-container">
            <iframe id="orderFrame" title="訂餐表單"></iframe>
        </div>
    </div>

    <!-- 日曆頁 -->
    <div id="calendarPage" class="page">
        <div class="calendar-header">
            <button class="calendar-nav" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
            <h2 id="currentMonthYear">2023年11月</h2>
            <button class="calendar-nav" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div class="calendar-weekdays">
            <div class="weekday">日</div>
            <div class="weekday">一</div>
            <div class="weekday">二</div>
            <div class="weekday">三</div>
            <div class="weekday">四</div>
            <div class="weekday">五</div>
            <div class="weekday">六</div>
        </div>
        <div id="calendarDays" class="calendar-days">
            <!-- 日曆天數將由JavaScript動態生成 -->
        </div>
    </div>

    <!-- 指南頁 -->
    <div id="guidePage" class="page">
        <h2 style="text-align: center; margin: 20px 0; color: #2c3e50;">公告指南</h2>
        <div class="guide-content" id="guideContent">
            <div class="guide-placeholder">
                指南內容將從後台載入...<br><br>
                （範例公告：每週二、三、四提供訂餐服務，請於前一天16:00至當天10:00間訂購。）
            </div>
        </div>
    </div>

    <!-- 固定底部導航 -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-page="homePage">
            <i class="fas fa-home"></i>主頁
        </button>
        <button class="nav-btn" data-page="orderPage">
            <i class="fas fa-utensils"></i>點餐
        </button>
        <button class="nav-btn" data-page="calendarPage">
            <i class="fas fa-calendar-alt"></i>月曆
        </button>
        <button class="nav-btn" data-page="guidePage">
            <i class="fas fa-bullhorn"></i>指南
        </button>
    </div>

    <script>
        // ==================== 全域變數與工具函數 ====================
        let currentPage = 'homePage';
        let currentDate = new Date(); // 用於日曆顯示
        let guideContent = localStorage.getItem('guideContent') || '指南內容將從後台載入...\n\n（範例公告：每週二、三、四提供訂餐服務，請於前一天16:00至當天10:00間訂購。）';

        // 切換頁面函數
        function switchPage(pageId) {
            // 更新活動頁面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // 更新導航按鈕狀態
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === pageId) {
                    btn.classList.add('active');
                }
            });
            
            // 記錄當前頁面
            currentPage = pageId;
            
            // 如果切換到特定頁面，執行對應初始化
            if (pageId === 'orderPage') {
                loadOrderForm();
            } else if (pageId === 'calendarPage') {
                renderCalendar(currentDate);
            }
        }

        // ==================== 主頁邏輯 ====================
        // 初始化主頁的「今日餐廳」顯示
        function updateHomePage() {
            const today = new Date();
            const formName = getFormForDate(today); // 根據規則取得表單名稱
            const displayText = formName ? `今日表單: ${formName}` : '今日沒有訂餐';
            document.getElementById('todayRestaurant').textContent = displayText;
        }

        // ==================== 點餐頁邏輯 ====================
        // 根據當前時間決定要載入哪個表單
        function getCurrentFormForOrder() {
            const now = new Date();
            const day = now.getDay(); // 0=週日, 1=週一, ... 6=週六
            const hour = now.getHours();
            
            // 根據您的規則：
            // 週一16:00 ~ 週二10:00：顯示週二表單
            // 週二10:00 ~ 週三10:00：顯示週三表單
            // 週三10:00 ~ 週四10:00：顯示週四表單
            // 其他時間：沒有表單 (none.html)
            
            let targetDay;
            if ((day === 1 && hour >= 16) || (day === 2 && hour < 10)) {
                targetDay = 2; // 週二
            } else if ((day === 2 && hour >= 10) || (day === 3 && hour < 10)) {
                targetDay = 3; // 週三
            } else if ((day === 3 && hour >= 10) || (day === 4 && hour < 10)) {
                targetDay = 4; // 週四
            } else {
                return null; // 沒有表單
            }
            
            // 根據目標週幾計算對應的表單
            return getFormForWeekday(targetDay);
        }

        // 根據週幾取得表單名稱 (簡化版，假設從1/1開始循環)
        function getFormForWeekday(weekday) {
            // 這是一個簡化邏輯，實際應從1/1開始計算
            // 這裡返回固定值用於演示
            const forms = ['form1', 'form2', 'form3', 'form4', 'form5', 'form6', 'form7', 
                          'form8', 'form9', 'form10', 'form11', 'form12', 'form13', 'form14', 'form15'];
            
            // 簡單演示：根據當前日期計算一個索引
            const startDate = new Date('2024-01-01');
            const today = new Date();
            const diffDays = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const formIndex = Math.floor(diffDays / 7 * 3) % forms.length; // 每週3天
            
            return forms[formIndex];
        }

        // 為日曆功能：根據日期取得表單名稱
        function getFormForDate(date) {
            const day = date.getDay();
            // 只有週二、三、四可能有表單
            if (day !== 2 && day !== 3 && day !== 4) return null;
            
            // 簡化邏輯：實際應從1/1開始循環計算
            // 這裡返回一個模擬值
            const forms = ['form1', 'form2', 'form3', 'form4', 'form5', 'form6', 'form7', 
                          'form8', 'form9', 'form10', 'form11', 'form12', 'form13', 'form14', 'form15'];
            
            const startDate = new Date(date.getFullYear(), 0, 1); // 當年的1月1日
            const diffDays = Math.floor((date - startDate) / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(diffDays / 7);
            const weekdayIndex = day - 2; // 週二=0, 週三=1, 週四=2
            
            const formIndex = (weeks * 3 + weekdayIndex) % forms.length;
            return forms[formIndex];
        }

        // 載入訂餐表單到iframe
        function loadOrderForm() {
            const formName = getCurrentFormForOrder();
            const orderInfo = document.getElementById('orderInfo');
            const orderFrame = document.getElementById('orderFrame');
            
            if (formName) {
                orderInfo.textContent = `正在載入: ${formName}`;
                // 實際應載入 formName.html，這裡使用空白頁面模擬
                orderFrame.srcdoc = `<html><body style="padding:20px;font-family:sans-serif"><h2>${formName} 訂餐表單</h2><p>這是表單內容的預覽位置。</p><p>實際將載入 ${formName}.html</p></body></html>`;
            } else {
                orderInfo.textContent = '今日沒有訂餐服務';
                // 載入 none.html
                orderFrame.srcdoc = `<html><body style="padding:20px;font-family:sans-serif;text-align:center"><h2 style="color:#e74c3c">今日沒有點餐</h2><p>目前不是訂餐開放時間。</p></body></html>`;
            }
        }

        // ==================== 日曆頁邏輯 ====================
        // 渲染月曆
        function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            
            // 更新標題
            document.getElementById('currentMonthYear').textContent = 
                `${year}年${month + 1}月`;
            
            // 計算本月第一天和最後一天
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0=週日
            
            // 清空日曆容器
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // 添加上個月的空白格子
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('day', 'empty');
                calendarDays.appendChild(emptyDay);
            }
            
            // 今天的日期（用於比較）
            const today = new Date();
            const isToday = (day) => {
                return year === today.getFullYear() && 
                       month === today.getMonth() && 
                       day === today.getDate();
            };
            
            // 添加本月天數格子
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('day');
                dayElement.textContent = day;
                
                // 為每個日期創建Date對象
                const currentDate = new Date(year, month, day);
                const dayOfWeek = currentDate.getDay(); // 0=週日
                
                // 檢查是否為今天
                if (isToday(day)) {
                    dayElement.classList.add('today');
                }
                
                // 檢查是否為過去的日期
                if (currentDate < new Date(today.getFullYear(), today.getMonth(), today.getDate())) {
                    dayElement.classList.add('past');
                }
                
                // 檢查是否為週二、三、四
                if (dayOfWeek === 2 || dayOfWeek === 3 || dayOfWeek === 4) {
                    dayElement.classList.add('form-day');
                    
                    // 獲取該日期的表單名稱
                    const formName = getFormForDate(currentDate);
                    
                    if (formName) {
                        const formSpan = document.createElement('span');
                        formSpan.classList.add('form-name');
                        formSpan.textContent = formName;
                        dayElement.appendChild(formSpan);
                    } else {
                        // 沒有表單，顯示紅色叉叉
                        const xSpan = document.createElement('span');
                        xSpan.classList.add('red-x');
                        xSpan.textContent = '✕';
                        dayElement.appendChild(xSpan);
                    }
                }
                
                calendarDays.appendChild(dayElement);
            }
        }

        // ==================== 指南頁邏輯 ====================
        // 載入指南內容
        function loadGuideContent() {
            document.getElementById('guideContent').textContent = guideContent;
        }

        // ==================== 事件監聽器初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化指南內容
            loadGuideContent();
            
            // 初始化主頁
            updateHomePage();
            
            // 綁定導航按鈕點擊事件
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    switchPage(pageId);
                });
            });
            
            // 綁定日曆導航按鈕
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar(currentDate);
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar(currentDate);
            });
            
            // 初始化日曆
            renderCalendar(currentDate);
            
            // 綁定日曆日期點擊事件
            document.getElementById('calendarDays').addEventListener('click', function(e) {
                if (e.target.classList.contains('day') && !e.target.classList.contains('empty')) {
                    const day = parseInt(e.target.textContent);
                    const clickedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    alert(`點擊了 ${clickedDate.toLocaleDateString('zh-TW')}\n實際將根據規則導向對應表單或 none.html`);
                }
            });
        });
    </script>
</body>
</html>